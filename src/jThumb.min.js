/* https://bitbucket.org/josema/jthumb */
(function(a){a.fn.extend({jThumb:function(b){return new a.jThumb(this,b)}});a.jThumb=function(b,c){var h=this;var f=[],n,e,j;c=a.extend({},a.jThumb.defaults,c);this.set=function(q,o){e=0;n=a.extend({},c,q);if(typeof o=="undefined"){o=true}if(n.background&&typeof n.onError=="function"&&!("backgroundSize" in document.body.style)){n.resize=n.zoom=false,n.crop=true;n.onError(a.jThumb.error[2])}var p;if(!o){j=0;p=0;b.each(function(){f[p]={};f[p].index=p;f[p].cElem=this;f[p].cWidth=a(f[p].cElem).width();f[p].cHeight=a(f[p].cElem).height();var r=(n.img==null||n.img=="")?this:a(f[p].cElem).find(n.img)[0];f[p].iElem=r;if(r!=null&&typeof r=="object"&&(a(r).is("img")||n.background)){k(r,p)}else{if(typeof n.onError=="function"){n.onError(a.jThumb.error[0],f[p])}}p+=1})}else{for(p in f){if(f[p].iElem!=null&&f[p].iWidth>0&&f[p].iHeight>0){d(p)}}}};this.set(null,false);this.getThumbByIndex=function(o){return f[o]};this.update=function(){for(index in f){var o=a(f[index].cElem).width(),p=a(f[index].cElem).height();if(f[index].cWidth!=o||f[index].cHeight!=p){f[index].cWidth=o;f[index].cHeight=p;d(index)}}};if(c.autoUpdate){a(window).resize(h.update)}function d(r){e+=1;if(typeof n.onBefore=="function"){n.onBefore(f[r])}var q=[];q=q.concat(g(n.align));q=q.concat(g(a(f[r].cElem).attr(n.attrName)));q=q.concat(g(a(f[r].iElem).attr(n.attrName)));var p=i(q);var o=m(f[r].cWidth,f[r].cHeight,f[r].iWidth,f[r].iHeight,p.crop,p.resize,p.zoom);if(n.background){a(f[r].iElem).css("backgroundSize",o[0]+"px "+o[1]+"px")}else{a(f[r].iElem).width(o[0]);a(f[r].iElem).height(o[1])}var t=[];t[0]=(p.paddingX[1]=="%")?Math.round((p.paddingX[0]*f[r].cWidth)/100):p.paddingX[0];t[1]=(p.paddingY[1]=="%")?Math.round((p.paddingY[0]*f[r].cHeight)/100):p.paddingY[0];var s=l(p.alignX,p.alignY,f[r].cWidth,f[r].cHeight,o[0],o[1]);if(n.background){a(f[r].iElem).css("backgroundPosition",(s[0]+t[0])+"px "+(s[1]+t[1])+"px")}else{a(f[r].iElem).css(n.moveX,(s[0]+t[0]));a(f[r].iElem).css(n.moveY,(s[1]+t[1]))}if(typeof n.onAfter=="function"){n.onAfter(f[r])}if(e==(f.length-j)&&typeof n.onFinish=="function"){n.onFinish(f[r])}}function k(q,p){var r=(n.background)?a(q).css("backgroundImage").replace(a.jThumb.consts.clean,"$1"):a(q).attr("src"),o=a(document.createElement("img"));f[p].tempImg=o;o.bind("load",{img:this},function(){f[p].iWidth=this.width;f[p].iHeight=this.height;if(typeof n.onLoadImage=="function"){n.onLoadImage(tempImg,f[p])}d(p)});o.bind("error",{img:this},function(){j+=1;if(typeof n.onError=="function"){n.onError(a.jThumb.error[1]+": "+r,f[p])}});o.attr("src",r)}function g(s){var p=[],t=0;if(s!=null&&s!=undefined&&typeof s=="string"&&s.length>=3){var q,o,r=jQuery.trim(s).split(" ");for(q=0;q<r.length;++q){o=a.jThumb.consts.args.exec(r[q]);if(o!=undefined&&o!=null&&o[1]!=undefined){p[t]=[(o[1]).toLowerCase()];if(o[4]!=undefined){p[t][1]=[o[4]]}if(o[5]!=undefined){p[t][1][1]=o[5]}t+=1}}}return p}function i(t){var r,q,p,s,o,w,u=jQuery.trim(a.jThumb.defaults.align).split(" ");var v={alignX:u[0],alignY:u[1],paddingX:[0],paddingY:[0],crop:n.crop,resize:n.resize,zoom:n.zoom};for(r=(t.length-1);r>=0;--r){if((q==null||p==null)&&(t[r][0]=="left"||t[r][0]=="right"||t[r][0]=="center")){if(q==null){q=t[r]}else{if(p==null){if(q[0]=="center"){p=q;q=t[r]}else{if(t[r][0]=="center"){p=t[r]}}}}}else{if(p==null&&(t[r][0]=="top"||t[r][0]=="bottom")){p=t[r]}else{if(s==null&&t[r][0]=="crop"){v.crop=true;s=true}else{if(o==null&&t[r][0]=="resize"){v.resize=true;o=true}else{if(w==null&&t[r][0]=="zoom"){v.zoom=true;w=true}else{if(s==null&&t[r][0]=="nocrop"){v.crop=false;s=true}else{if(o==null&&t[r][0]=="noresize"){v.resize=false;o=true}else{if(w==null&&t[r][0]=="nozoom"){v.zoom=false;w=true}}}}}}}}}if(q!=null){v.alignX=q[0];if(q[1]!=null&&q[1][0].length>0){v.paddingX[0]=parseInt(q[1][0]);if(q[1][1]!=null){v.paddingX[1]=q[1][1]}}}if(p!=null){v.alignY=p[0];if(p[1]!=null&&p[1][0].length>0){v.paddingY[0]=parseInt(p[1][0]);if(p[1][1]!=null){v.paddingY[1]=p[1][1]}}}return v}function m(u,q,t,p,r,o,v){var w=[t,p];if((!(!v&&(t<u||p<q)))&&(!r||(o&&t>u&&p>q)||(v&&(t<u||p<q)))){var s=Math.round((p*u)/t);w=((!r&&s>q)||(r&&s<q&&(o||v)))?[Math.round((t*q)/p),q]:[u,s]}return w}function l(p,u,o,r,q,s){var t=newY=0;if(p=="right"){t=(o-q)}else{if(p=="center"){t=Math.round((o-q)/2)}}if(u=="bottom"){newY=(r-s)}else{if(u=="center"){newY=Math.round((r-s)/2)}}return[t,newY]}};a.jThumb.defaults={autoUpdate:false,background:false,img:"> img",align:"center center",crop:true,resize:true,zoom:false,onError:null,onLoadImage:null,onBefore:null,onAfter:null,onFinish:null,attrName:"jthumb",moveX:"marginLeft",moveY:"marginTop"};a.jThumb.consts={args:/(center|left|top|right|bottom|resize|noresize|zoom|nozoom|crop|nocrop)(\((([-0-9]+)(%|px)?)?\))?/i,clean:/url\("?([^")]+).*/i};a.jThumb.error=["Image not found inside the container","The image could not be loaded","This browser doesn't support CSS3 for background-size"]})(jQuery);