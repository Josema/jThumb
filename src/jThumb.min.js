(function(a){a.fn.extend({jThumb:function(b){return new a.jThumb(this,b)}});a.jThumb=function(b,c){var f=[],m,e,i;c=a.extend({},a.jThumb.defaults,c);this.set=function(p,n){e=0;m=a.extend({},c,p);if(typeof n=="undefined"){n=true}if(m.background&&typeof m.onError=="function"&&!("backgroundSize" in document.body.style)){m.resize=m.zoom=false,m.crop=true;m.onError(a.jThumb.error[2])}var o;if(!n){i=0;o=0;b.each(function(){f[o]={};f[o].index=o;f[o].cElem=this;f[o].cWidth=a(f[o].cElem).width();f[o].cHeight=a(f[o].cElem).height();var q=(m.img==null||m.img=="")?this:a(f[o].cElem).find(m.img)[0];f[o].iElem=q;if(q!=null&&typeof q=="object"&&(a(q).is("img")||m.background)){j(q,o)}else{if(typeof m.onError=="function"){m.onError(a.jThumb.error[0],f[o])}}o+=1})}else{for(o in f){if(f[o].iElem!=null&&f[o].iWidth>0&&f[o].iHeight>0){d(o)}}}};this.set(null,false);this.getThumbByIndex=function(n){return f[n]};function d(q){e+=1;if(typeof m.onBefore=="function"){m.onBefore(f[q])}var p=[];p=p.concat(g(m.align));p=p.concat(g(a(f[q].cElem).attr(m.attrName)));p=p.concat(g(a(f[q].iElem).attr(m.attrName)));var o=h(p);var n=l(f[q].cWidth,f[q].cHeight,f[q].iWidth,f[q].iHeight,o.crop,o.resize,o.zoom);if(m.background){a(f[q].iElem).css("backgroundSize",n[0]+"px "+n[1]+"px")}else{a(f[q].iElem).width(n[0]);a(f[q].iElem).height(n[1])}var s=[];s[0]=(o.paddingX[1]=="%")?Math.round((o.paddingX[0]*f[q].cWidth)/100):o.paddingX[0];s[1]=(o.paddingY[1]=="%")?Math.round((o.paddingY[0]*f[q].cHeight)/100):o.paddingY[0];var r=k(o.alignX,o.alignY,f[q].cWidth,f[q].cHeight,n[0],n[1]);if(m.background){a(f[q].iElem).css("backgroundPosition",r[0]+"px "+r[1]+"px")}else{a(f[q].iElem).css(m.moveX,(r[0]+s[0]));a(f[q].iElem).css(m.moveY,(r[1]+s[1]))}if(typeof m.onAfter=="function"){m.onAfter(f[q])}if(e==(f.length-i)&&typeof m.onFinish=="function"){m.onFinish(f[q])}}function j(p,o){var q=(m.background)?a(p).css("backgroundImage").replace(a.jThumb.consts.clean,"$1"):a(p).attr("src"),n=a(document.createElement("img"));f[o].tempImg=n;n.bind("load",{img:this},function(){f[o].iWidth=this.width;f[o].iHeight=this.height;if(typeof m.onLoadImage=="function"){m.onLoadImage(tempImg,f[o])}d(o)});n.bind("error",{img:this},function(){i+=1;if(typeof m.onError=="function"){m.onError(a.jThumb.error[1]+": "+q,f[o])}});n.attr("src",q)}function g(s){var p=[],t=0;if(s!=null&&s!=undefined&&typeof s=="string"&&s.length>=3){var q,o,r=jQuery.trim(s).split(" ");for(q=0;q<r.length;++q){o=a.jThumb.consts.args.exec(r[q]);if(o!=undefined&&o!=null&&o[1]!=undefined){p[t]=[(o[1]).toLowerCase()];if(o[4]!=undefined){p[t][1]=[o[4]]}if(o[5]!=undefined){p[t][1][1]=o[5]}t+=1}}}return p}function h(s){var q,p,o,r,n,v,t=jQuery.trim(a.jThumb.defaults.align).split(" ");var u={alignX:t[0],alignY:t[1],paddingX:[0],paddingY:[0],crop:m.crop,resize:m.resize,zoom:m.zoom};for(q=(s.length-1);q>=0;--q){if((p==null||o==null)&&(s[q][0]=="left"||s[q][0]=="right"||s[q][0]=="center")){if(p==null){p=s[q]}else{if(o==null){if(p[0]=="center"){o=p;p=s[q]}else{if(s[q][0]=="center"){o=s[q]}}}}}else{if(o==null&&(s[q][0]=="top"||s[q][0]=="bottom")){o=s[q]}else{if(r==null&&s[q][0]=="crop"){u.crop=true;r=true}else{if(n==null&&s[q][0]=="resize"){u.resize=true;n=true}else{if(v==null&&s[q][0]=="zoom"){u.zoom=true;v=true}else{if(r==null&&s[q][0]=="nocrop"){u.crop=false;r=true}else{if(n==null&&s[q][0]=="noresize"){u.resize=false;n=true}else{if(v==null&&s[q][0]=="nozoom"){u.zoom=false;v=true}}}}}}}}}if(p!=null){u.alignX=p[0];if(p[1]!=null&&p[1][0].length>0){u.paddingX[0]=parseInt(p[1][0]);if(p[1][1]!=null){u.paddingX[1]=p[1][1]}}}if(o!=null){u.alignY=o[0];if(o[1]!=null&&o[1][0].length>0){u.paddingY[0]=parseInt(o[1][0]);if(o[1][1]!=null){u.paddingY[1]=o[1][1]}}}return u}function l(t,p,s,o,q,n,u){var v=[s,o];if((!(!u&&(s<t||o<p)))&&(!q||(n&&s>t&&o>p)||(u&&(s<t||o<p)))){var r=Math.round((o*t)/s);v=((!q&&r>p)||(q&&r<p&&(n||u)))?[Math.round((s*p)/o),p]:[t,r]}return v}function k(o,t,n,q,p,r){var s=newY=0;if(o=="right"){s=(n-p)}else{if(o=="center"){s=Math.round((n-p)/2)}}if(t=="bottom"){newY=(q-r)}else{if(t=="center"){newY=Math.round((q-r)/2)}}return[s,newY]}};a.jThumb.defaults={background:false,img:"> img",align:"center center",crop:true,resize:true,zoom:false,onError:null,onLoadImage:null,onBefore:null,onAfter:null,onFinish:null,attrName:"jthumb",moveX:"marginLeft",moveY:"marginTop"};a.jThumb.consts={args:/(center|left|top|right|bottom|resize|noresize|zoom|nozoom|crop|nocrop)(\((([-0-9]+)(%|px)?)?\))?/i,clean:/url\("?([^")]+).*/i};a.jThumb.error=["Image not found inside the container","The image could not be loaded","This browser doesn't support CSS3 for background-size"]})(jQuery);